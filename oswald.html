<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oswald Triangle - Combustion Analysis Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .panel:hover {
            transform: translateY(-5px);
        }

        .panel h2 {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.4rem;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
        }

        .input-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .input-field {
            display: flex;
            flex-direction: column;
        }

        .input-field label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #4a5568;
            font-size: 0.9rem;
        }

        .input-field input {
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-field input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .graph-container {
            grid-column: 1 / -1;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }

        #oswaldCanvas {
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            max-width: 100%;
            height: auto;
            background: #f8f9fa;
        }

        .results {
            grid-column: 1 / -1;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .result-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .result-item .label {
            font-weight: 600;
            color: #4a5568;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .result-item .value {
            font-size: 1.2rem;
            color: #2d3748;
            font-weight: 700;
        }

        .fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: white;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .fullscreen #oswaldCanvas {
            max-width: 90vw;
            max-height: 80vh;
        }

        .fullscreen .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #e53e3e;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 200px;
            }
        }

        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
            font-size: 0.9rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }

        .legend-line {
            width: 20px;
            height: 3px;
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Oswald Triangle Simulator</h1>
            <p>Combustion Analysis Tool for Fuel Composition and Orsat Data</p>
        </div>

        <div class="main-content">
            <!-- Fuel Composition Panel -->
            <div class="panel">
                <h2>Fuel Composition (%)</h2>
                <div class="input-group">
                    <div class="input-field">
                        <label for="carbon">Carbon (C)</label>
                        <input type="number" id="carbon" step="0.01" value="85.0" min="0" max="100">
                    </div>
                    <div class="input-field">
                        <label for="hydrogen">Hydrogen (H)</label>
                        <input type="number" id="hydrogen" step="0.01" value="12.0" min="0" max="100">
                    </div>
                    <div class="input-field">
                        <label for="oxygen">Oxygen (O)</label>
                        <input type="number" id="oxygen" step="0.01" value="2.0" min="0" max="100">
                    </div>
                    <div class="input-field">
                        <label for="nitrogen">Nitrogen (N)</label>
                        <input type="number" id="nitrogen" step="0.01" value="0.8" min="0" max="100">
                    </div>
                    <div class="input-field">
                        <label for="sulfur">Sulfur (S)</label>
                        <input type="number" id="sulfur" step="0.01" value="0.2" min="0" max="100">
                    </div>
                    <div class="input-field">
                        <label for="water">Water (H₂O)</label>
                        <input type="number" id="water" step="0.01" value="0.0" min="0" max="100">
                    </div>
                </div>
            </div>

            <!-- Orsat Data Panel -->
            <div class="panel">
                <h2>Orsat Analysis Data (%)</h2>
                <div class="input-group">
                    <div class="input-field">
                        <label for="co2_measured">CO₂ Measured</label>
                        <input type="number" id="co2_measured" step="0.01" value="12.5" min="0" max="21">
                    </div>
                    <div class="input-field">
                        <label for="o2_measured">O₂ Measured</label>
                        <input type="number" id="o2_measured" step="0.01" value="6.8" min="0" max="21">
                    </div>
                </div>

                <div class="controls">
                    <button class="btn btn-primary" onclick="calculateOswald()">Calculate</button>
                    <button class="btn btn-success" onclick="showGraph()">View Graph</button>
                    <button class="btn btn-secondary" onclick="clearInputs()">Clear</button>
                    <button class="btn btn-warning" onclick="toggleFullscreen()">Fullscreen</button>
                </div>
            </div>

            <!-- Graph Container -->
            <div class="graph-container" id="graphContainer" style="display: none;">
                <h2>Oswald Triangle</h2>
                <canvas id="oswaldCanvas" width="600" height="600"></canvas>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ff4444;"></div>
                        <span>Point A (21% O₂, 0% CO₂)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #4444ff;"></div>
                        <span>Point C (0% O₂, kCO₂%)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #44ff44;"></div>
                        <span>Point D (qO₂%, 0% CO₂)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ff8800;"></div>
                        <span>Experimental Point (Orsat)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #8800ff;"></div>
                        <span>Intersection Point</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #2266cc;"></div>
                        <span>Line AC (Complete Combustion)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #cc6622;"></div>
                        <span>Line CD (Incomplete Combustion)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #22cc66;"></div>
                        <span>CO Limit Line</span>
                    </div>
                </div>
            </div>

            <!-- Results Panel -->
            <div class="results" id="resultsPanel" style="display: none;">
                <h2>Calculation Results</h2>
                <div class="results-grid" id="resultsGrid">
                    <!-- Results will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables for calculations
        let calculationResults = {};
        let isFullscreen = false;

        // Oswald Triangle calculation functions
        function calculateOswald() {
            // Get input values
            const fuel = {
                C: parseFloat(document.getElementById('carbon').value) || 0,
                H: parseFloat(document.getElementById('hydrogen').value) || 0,
                O: parseFloat(document.getElementById('oxygen').value) || 0,
                N: parseFloat(document.getElementById('nitrogen').value) || 0,
                S: parseFloat(document.getElementById('sulfur').value) || 0,
                H2O: parseFloat(document.getElementById('water').value) || 0
            };

            const orsat = {
                CO2: parseFloat(document.getElementById('co2_measured').value) || 0,
                O2: parseFloat(document.getElementById('o2_measured').value) || 0
            };

            // Validate fuel composition
            const totalComposition = fuel.C + fuel.H + fuel.O + fuel.N + fuel.S + fuel.H2O;
            if (Math.abs(totalComposition - 100) > 0.1) {
                alert(`Warning: Fuel composition totals ${totalComposition.toFixed(2)}% instead of 100%`);
            }

            // Calculate molecular weights and stoichiometric coefficients
            const MW = { C: 12.01, H: 1.008, O: 15.999, N: 14.007, S: 32.06, H2O: 18.015 };
            
            // Calculate moles per 100g of fuel
            const moles = {
                C: fuel.C / MW.C,
                H: fuel.H / MW.H,
                O: fuel.O / MW.O,
                N: fuel.N / MW.N,
                S: fuel.S / MW.S,
                H2O: fuel.H2O / MW.H2O
            };

            // Available hydrogen (H - 2*H2O)
            const H_available = moles.H - 2 * moles.H2O;
            
            // Theoretical oxygen requirement for complete combustion (mol O2 per 100g fuel)
            const O2_complete = moles.C + H_available/4 + moles.S - moles.O/2;
            
            // Theoretical oxygen requirement for incomplete combustion (only C to CO)
            const O2_incomplete = moles.C/2 + H_available/4 + moles.S - moles.O/2;
            
            // Theoretical air requirements (21% O2 in air)
            const air_complete = O2_complete / 0.21;
            const air_incomplete = O2_incomplete / 0.21;
            
            // Theoretical CO2 production for complete combustion
            const CO2_complete = moles.C;
            
            // Theoretical CO production for incomplete combustion
            const CO_incomplete = moles.C;
            
            // Calculate kCO2 (maximum CO2 percentage in dry flue gas)
            const N2_complete = air_complete * 0.79 + moles.N;
            const total_dry_complete = CO2_complete + N2_complete;
            const kCO2 = (CO2_complete / total_dry_complete) * 100;
            
            // Calculate qO2 (oxygen percentage for incomplete combustion)
            const N2_incomplete = air_incomplete * 0.79 + moles.N;
            const total_dry_incomplete = CO_incomplete + N2_incomplete;
            const qO2 = 21 - (21 * total_dry_incomplete) / (total_dry_incomplete + O2_incomplete);
            
            // Calculate pCO (CO percentage for incomplete combustion)
            const pCO = (CO_incomplete / total_dry_incomplete) * 100;
            
            // Calculate excess air from Orsat data
            const excess_air_ratio = (21 - orsat.CO2) / (21 - kCO2) - 1;
            const excess_air_percent = excess_air_ratio * 100;
            
            // Calculate actual air-fuel ratio
            const actual_air = air_complete * (1 + excess_air_ratio);
            
            // Calculate combustion efficiency
            const combustion_efficiency = (kCO2 / orsat.CO2) * 100;
            
            // Oswald Triangle points calculation (correct definitions)
            // Point A: (21% O2, 0% CO2) - Maximum excess air
            const pointA = { x: 21, y: 0 };
            
            // Point C: (0% O2, kCO2%) - Complete combustion, no excess air
            const pointC = { x: 0, y: kCO2 };
            
            // Point D: (qO2%, 0% CO2) - Incomplete combustion limit
            const pointD = { x: qO2, y: 0 };
            
            // Experimental point from Orsat data
            const experimentalPoint = { x: orsat.O2, y: orsat.CO2 };
            
            // Calculate intersection point of AC line with experimental O2 level
            // Line AC equation: y = kCO2 * (21 - x) / 21
            const intersection_y = kCO2 * (21 - orsat.O2) / 21;
            const intersection = { x: orsat.O2, y: intersection_y };

            // Store results
            calculationResults = {
                fuel,
                orsat,
                H_available: H_available.toFixed(4),
                O2_complete: O2_complete.toFixed(4),
                O2_incomplete: O2_incomplete.toFixed(4),
                air_complete: air_complete.toFixed(4),
                air_incomplete: air_incomplete.toFixed(4),
                CO2_complete: CO2_complete.toFixed(4),
                CO_incomplete: CO_incomplete.toFixed(4),
                kCO2: kCO2.toFixed(2),
                qO2: qO2.toFixed(2),
                pCO: pCO.toFixed(2),
                excess_air_percent: excess_air_percent.toFixed(2),
                actual_air: actual_air.toFixed(4),
                combustion_efficiency: combustion_efficiency.toFixed(2),
                pointA,
                pointC,
                pointD,
                experimentalPoint,
                intersection,
                total_composition: totalComposition.toFixed(2)
            };

            displayResults();
            document.getElementById('resultsPanel').style.display = 'block';
        }

        function displayResults() {
            const resultsGrid = document.getElementById('resultsGrid');
            resultsGrid.innerHTML = `
                <div class="result-item">
                    <div class="label">Total Fuel Composition</div>
                    <div class="value">${calculationResults.total_composition}%</div>
                </div>
                <div class="result-item">
                    <div class="label">Available Hydrogen</div>
                    <div class="value">${calculationResults.H_available} mol</div>
                </div>
                <div class="result-item">
                    <div class="label">O₂ Complete Combustion</div>
                    <div class="value">${calculationResults.O2_complete} mol</div>
                </div>
                <div class="result-item">
                    <div class="label">O₂ Incomplete Combustion</div>
                    <div class="value">${calculationResults.O2_incomplete} mol</div>
                </div>
                <div class="result-item">
                    <div class="label">Air Complete Combustion</div>
                    <div class="value">${calculationResults.air_complete} mol</div>
                </div>
                <div class="result-item">
                    <div class="label">Air Incomplete Combustion</div>
                    <div class="value">${calculationResults.air_incomplete} mol</div>
                </div>
                <div class="result-item">
                    <div class="label">kCO₂ (Max CO₂%)</div>
                    <div class="value">${calculationResults.kCO2}%</div>
                </div>
                <div class="result-item">
                    <div class="label">qO₂ (Incomplete O₂%)</div>
                    <div class="value">${calculationResults.qO2}%</div>
                </div>
                <div class="result-item">
                    <div class="label">pCO (CO%)</div>
                    <div class="value">${calculationResults.pCO}%</div>
                </div>
                <div class="result-item">
                    <div class="label">Excess Air</div>
                    <div class="value">${calculationResults.excess_air_percent}%</div>
                </div>
                <div class="result-item">
                    <div class="label">Combustion Efficiency</div>
                    <div class="value">${calculationResults.combustion_efficiency}%</div>
                </div>
                <div class="result-item">
                    <div class="label">Point A (O₂, CO₂)</div>
                    <div class="value">(${calculationResults.pointA.x.toFixed(1)}, ${calculationResults.pointA.y.toFixed(1)})</div>
                </div>
                <div class="result-item">
                    <div class="label">Point C (O₂, CO₂)</div>
                    <div class="value">(${calculationResults.pointC.x.toFixed(1)}, ${calculationResults.pointC.y.toFixed(1)})</div>
                </div>
                <div class="result-item">
                    <div class="label">Point D (O₂, CO₂)</div>
                    <div class="value">(${calculationResults.pointD.x.toFixed(1)}, ${calculationResults.pointD.y.toFixed(1)})</div>
                </div>
                <div class="result-item">
                    <div class="label">Experimental Point</div>
                    <div class="value">(${calculationResults.experimentalPoint.x.toFixed(1)}, ${calculationResults.experimentalPoint.y.toFixed(1)})</div>
                </div>
                <div class="result-item">
                    <div class="label">Intersection Point</div>
                    <div class="value">(${calculationResults.intersection.x.toFixed(1)}, ${calculationResults.intersection.y.toFixed(1)})</div>
                </div>
            `;
        }

        function showGraph() {
            if (Object.keys(calculationResults).length === 0) {
                alert('Please calculate first!');
                return;
            }
            
            document.getElementById('graphContainer').style.display = 'block';
            drawOswaldTriangle();
        }

        function drawOswaldTriangle() {
            const canvas = document.getElementById('oswaldCanvas');
            const ctx = canvas.getContext('2d');
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Set up coordinate system (1:1 aspect ratio)
            const margin = 80;
            const graphSize = Math.min(canvas.width, canvas.height) - 2 * margin;
            const graphWidth = graphSize;
            const graphHeight = graphSize;
            
            // Calculate center position for square graph
            const startX = (canvas.width - graphWidth) / 2;
            const startY = (canvas.height - graphHeight) / 2 + margin/2;
            
            // Draw axes
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            // X-axis
            ctx.moveTo(startX, startY + graphHeight);
            ctx.lineTo(startX + graphWidth, startY + graphHeight);
            // Y-axis
            ctx.moveTo(startX, startY + graphHeight);
            ctx.lineTo(startX, startY);
            ctx.stroke();
            
            // Draw grid
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 21; i += 3) {
                const x = startX + (i / 21) * graphWidth;
                const y = startY + graphHeight - (i / 21) * graphHeight;
                
                // Vertical grid lines
                ctx.beginPath();
                ctx.moveTo(x, startY);
                ctx.lineTo(x, startY + graphHeight);
                ctx.stroke();
                
                // Horizontal grid lines
                ctx.beginPath();
                ctx.moveTo(startX, y);
                ctx.lineTo(startX + graphWidth, y);
                ctx.stroke();
            }
            
            // Draw axis labels
            ctx.fillStyle = '#333';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            
            // X-axis labels
            for (let i = 0; i <= 21; i += 3) {
                const x = startX + (i / 21) * graphWidth;
                ctx.fillText(i.toString(), x, startY + graphHeight + 20);
            }
            
            // Y-axis labels
            ctx.textAlign = 'right';
            for (let i = 0; i <= 21; i += 3) {
                const y = startY + graphHeight - (i / 21) * graphHeight;
                ctx.fillText(i.toString(), startX - 10, y + 4);
            }
            
            // Axis titles
            ctx.textAlign = 'center';
            ctx.font = '16px Arial';
            ctx.fillText('O₂ (%)', startX + graphWidth/2, startY + graphHeight + 50);
            
            ctx.save();
            ctx.translate(startX - 50, startY + graphHeight/2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('CO₂ (%)', 0, 0);
            ctx.restore();
            
            // Convert coordinates to canvas coordinates
            function toCanvasCoords(x, y) {
                return {
                    x: startX + (x / 21) * graphWidth,
                    y: startY + graphHeight - (y / 21) * graphHeight
                };
            }
            
            // Draw Oswald Triangle lines
            const canvasA = toCanvasCoords(calculationResults.pointA.x, calculationResults.pointA.y);
            const canvasC = toCanvasCoords(calculationResults.pointC.x, calculationResults.pointC.y);
            const canvasD = toCanvasCoords(calculationResults.pointD.x, calculationResults.pointD.y);
            const canvasIntersection = toCanvasCoords(calculationResults.intersection.x, calculationResults.intersection.y);
            
            // Line AC (Complete combustion line)
            ctx.strokeStyle = '#2266cc';
            ctx.lineWidth = 3;
            ctx.setLineDash([]);
            ctx.beginPath();
            ctx.moveTo(canvasA.x, canvasA.y);
            ctx.lineTo(canvasC.x, canvasC.y);
            ctx.stroke();
            
            // Line CD (Incomplete combustion line)
            ctx.strokeStyle = '#cc6622';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(canvasC.x, canvasC.y);
            ctx.lineTo(canvasD.x, canvasD.y);
            ctx.stroke();
            
            // CO Limit Line (from intersection to D)
            ctx.strokeStyle = '#22cc66';
            ctx.lineWidth = 2;
            ctx.setLineDash([8, 4]);
            ctx.beginPath();
            ctx.moveTo(canvasIntersection.x, canvasIntersection.y);
            ctx.lineTo(canvasD.x, canvasD.y);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Draw points
            function drawPoint(point, color, label, size = 8) {
                const canvasPoint = toCanvasCoords(point.x, point.y);
                
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(canvasPoint.x, canvasPoint.y, size, 0, 2 * Math.PI);
                ctx.fill();
                
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Label
                ctx.fillStyle = '#333';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(label, canvasPoint.x, canvasPoint.y - 15);
                
                // Coordinates
                ctx.font = '10px Arial';
                ctx.fillText(`(${point.x.toFixed(1)}, ${point.y.toFixed(1)})`, canvasPoint.x, canvasPoint.y + 25);
            }
            
            // Draw all points
            drawPoint(calculationResults.pointA, '#ff4444', 'A', 8);
            drawPoint(calculationResults.pointC, '#4444ff', 'C', 8);
            drawPoint(calculationResults.pointD, '#44ff44', 'D', 8);
            drawPoint(calculationResults.experimentalPoint, '#ff8800', 'Exp', 10);
            drawPoint(calculationResults.intersection, '#8800ff', 'Int', 6);
            
            // Draw title
            ctx.fillStyle = '#333';
            ctx.font = 'bold 20px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Oswald Triangle', canvas.width / 2, 30);
            
            // Draw subtitle with key parameters
            ctx.font = '12px Arial';
            ctx.fillText(`kCO₂ = ${calculationResults.kCO2}% | qO₂ = ${calculationResults.qO2}% | pCO = ${calculationResults.pCO}%`, 
                        canvas.width / 2, 50);
        }

        function clearInputs() {
            document.getElementById('carbon').value = '';
            document.getElementById('hydrogen').value = '';
            document.getElementById('oxygen').value = '';
            document.getElementById('nitrogen').value = '';
            document.getElementById('sulfur').value = '';
            document.getElementById('water').value = '';
            document.getElementById('co2_measured').value = '';
            document.getElementById('o2_measured').value = '';
            
            document.getElementById('graphContainer').style.display = 'none';
            document.getElementById('resultsPanel').style.display = 'none';
            
            calculationResults = {};
        }

        function toggleFullscreen() {
            const graphContainer = document.getElementById('graphContainer');
            
            if (!isFullscreen) {
                if (Object.keys(calculationResults).length === 0) {
                    alert('Please calculate and view graph first!');
                    return;
                }
                
                graphContainer.classList.add('fullscreen');
                graphContainer.innerHTML += '<button class="close-btn" onclick="toggleFullscreen()">Close Fullscreen</button>';
                
                // Resize canvas for fullscreen
                const canvas = document.getElementById('oswaldCanvas');
                canvas.width = Math.min(window.innerWidth * 0.8, window.innerHeight * 0.8);
                canvas.height = canvas.width; // Maintain 1:1 aspect ratio
                
                drawOswaldTriangle();
                isFullscreen = true;
            } else {
                graphContainer.classList.remove('fullscreen');
                const closeBtn = graphContainer.querySelector('.close-btn');
                if (closeBtn) closeBtn.remove();
                
                // Reset canvas size
                const canvas = document.getElementById('oswaldCanvas');
                canvas.width = 600;
                canvas.height = 600;
                
                drawOswaldTriangle();
                isFullscreen = false;
            }
        }

        // Initialize with sample data
        window.addEventListener('load', function() {
            // Sample data is already set in HTML inputs
            console.log('Oswald Triangle Simulator loaded successfully!');
        });

        // Handle window resize in fullscreen
        window.addEventListener('resize', function() {
            if (isFullscreen) {
                const canvas = document.getElementById('oswaldCanvas');
                canvas.width = Math.min(window.innerWidth * 0.8, window.innerHeight * 0.8);
                canvas.height = canvas.width;
                drawOswaldTriangle();
            }
        });
    </script>
</body>
</html>
